---
import { twMerge } from "tailwind-merge";
interface Props {
  className?: string;
  slidesId: string;
  generatedId: string;
  maxSlides: number;
}

const { slidesId, className, generatedId, maxSlides } = Astro.props;

const slideItems = Array.from(
  { length: maxSlides },
  (_, i) => `${slidesId}-${i + 1}`,
);
---

<slide-show
  data-id={`${slidesId}-${generatedId}`}
  class={twMerge(
    "xs:min-h-none min-h-[180px] h-fit aspect-[3/2] relative",
    className,
  )}
>
  {
    slideItems.map((slideItem, index) => (
      <div
        class={`slide slide-items-${slidesId}-${generatedId} fade ${
          index === 0 ? "active" : ""
        }`}
      >
        <img src={`/${slideItem}.webp`} alt={slideItem} />
      </div>
    ))
  }
</slide-show>

<script>
  class PricingCard extends HTMLElement {
    constructor() {
      super();

      const message = this.dataset.id;
      let slideIndex = 0;

      if (message) {
        showSlides();
      }

      function showSlides() {
        let slides = document.getElementsByClassName(`slide-items-${message}`);

        // Remove active class from all slides
        for (let i = 0; i < slides.length; i++) {
          slides[i].classList.remove("active");
        }

        slideIndex++;

        if (slideIndex > slides.length) {
          slideIndex = 1;
        }

        slides[slideIndex - 1].classList.add("active"); // Add active class to current slide

        setTimeout(showSlides, 2000); // Adjust time to 4 seconds (2s for fade out and 2s for fade in)
      }
    }
  }

  customElements.define("slide-show", PricingCard);
</script>

<style>
  .slide {
    opacity: 0;
    display: flex;
    flex-direction: column;
    visibility: hidden;
    transition:
      opacity 1s,
      visibility 1s; /* Add visibility to the transition */
    align-items: end;
    justify-content: end;
    width: 100%;
    height: 100%;
    background: #e5e7eb;
    position: absolute; /* Make slides absolute to overlap */
    top: 0;
    left: 0;
    z-index: 1; /* Default z-index */
  }

  .slide.active {
    z-index: 2;
    opacity: 1;
    visibility: visible;
  }

  .fade {
    animation-name: fade;
    animation-duration: 1s;
  }

  @keyframes fade {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .slide img {
    width: 100%;
    max-height: 100%;
  }
</style>
